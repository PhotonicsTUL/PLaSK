<?xml version="1.0" encoding="utf-8" ?>
<solvers xmlns="http://phys.p.lodz.pl/solvers.xsd">

  <solver name="EffectiveIndex2D" category="optical" lib="effective">
    Scalar optical solver based on the effective index method.

    <geometry type="Cartesian2D"/>

    <mesh type="Rectangular2D, Ordered, Regular" optional="yes"/>

    <tag name="mode" label="Mode Properties">
      <attr name="polarization" label="Polarization" type="choice" default="TE">
        Longitudnally-propagating mode polarization (TE or TM).
        <choice>TE</choice>
        <choice>TM</choice>
      </attr>
      <attr name="wavelength" label="Wavelength" type="float" unit="nm">Mode wavelength.</attr>
      <attr name="vneff" label="Vertical effective index" type="float" unit="-">Initial vertical effective index of the in location in which the vertical solution is calculated; setting this value helps to find models in very long resonators.</attr>
      <attr name="vat" label="Vertical solution coord" type="float" unit="µm" default="0.000">Horizontal position of at which the vertical part of the field is calculated.</attr>
      <attr name="emission" label="Direction of emission" type="choice" default="front">
        Direction of the useful light emission. Necessary for the over-threshold model to correctly compute the output power.
        <choice>front</choice>
        <choice>back</choice>
      </attr>
    </tag>

    <tag name="root" label="Parameters of the Horizontal Root-Finding Algorithm">
      Parameters of the horizontal root-finding algorithm.
      <attr name="method" label="Root finding method" type="choice" default="muller">
        Root finding algorithm.
        <choice>muller</choice>
        <choice>broyden</choice>
        <choice>brent</choice>
      </attr>
      <attr name="tolx" label="Tolerance on effective index" type="float" default="1e-6">Maximum change of the effective frequency parameter which is allowed for convergent solution.</attr>
      <attr name="tolf-min" label="Sufficient determinant value" type="float" default="1e-7">Minimum value of the determinant sufficient to assume convergence.</attr>
      <attr name="tolf-max" label="Required determinant value" type="float" default="2e-5">Maximum value of the determinant required to assume convergence.</attr>
      <attr name="maxstep" label="Maximum Broyden iteration step" type="float" default="0.1">Maximum step in one iteration of root finding. Significant for the Broyden's method only.</attr>
      <attr name="maxiter" label="Maximum number of iterations" type="int" default="500">Maximum number of root finding iterations.</attr>
      <attr name="alpha" label="Broyden decrease factor" type="float" default="1e-7">Parameter ensuring sufficient decrease of determinant in each step (Broyden method only).</attr>
      <attr name="lambda" label="Minimum Broyden step decrease ratio" type="float" default="1e-8">Minimum decrease ratio of one step (Broyden method only).</attr>
      <attr name="initial-range" label="Initial Muller range size" type="complex" default="0.001">Initial range size (Muller method only).</attr>
    </tag>

    <tag name="stripe-root" label="Parameters of the Vertical Root-Finding Algorithm">
      Parameters of root-finding algorithm for one stripe.
      <attr name="method" label="Root finding method" type="choice">
        Root finding algorithm.
        <choice>muller</choice>
        <choice>broyden</choice>
        <choice>brent</choice>
      </attr>
      <attr name="tolx" label="Tolerance on effective index" type="float" default="1e-6">Maximum change of the effective frequency parameter which is allowed for convergent solution.</attr>
      <attr name="tolf-min" label="Sufficient determinant value" type="float" default="1e-7">Minimum value of the determinant sufficient to assume convergence.</attr>
      <attr name="tolf-max" label="Required determinant value" type="float" default="1e-5">Maximum value of the determinant required to assume convergence.</attr>
      <attr name="maxstep" label="Maximum Broyden iteration step" type="float" default="0.1">Maximum step in one iteration of root finding. Significant for the Broyden's method only.</attr>
      <attr name="maxiter" label="Maximum number of iterations" type="int" default="500">Maximum number of root finding iterations.</attr>
      <attr name="alpha" label="Broyden decrease factor" type="float" default="1e-7">Parameter ensuring sufficient decrease of determinant in each step (Broyden method only).</attr>
      <attr name="lambda" label="Minimum Broyden step decrease ratio" type="float" default="1e-8">Minimum decrease ratio of one step (Broyden method only).</attr>
      <attr name="initial-range" label="Initial Muller range size" type="complex" default="0.001">Initial range size (Muller method only).</attr>
    </tag>

    <tag name="mirrors" label="Mirror Losses">
      <attr name="R1" label="Front reflectivity" type="float">Reflectivity of the front mirror.</attr>
      <attr name="R2" label="Back reflectivity" type="float">Reflectivity of the back mirror.</attr>
    </tag>

    <flow>
      <receiver name="inTemperature"/>
      <receiver name="inGain"/>
      <provider name="outLightMagnitude"/>
      <provider name="outRefractiveIndex"/>
      <provider name="outHeat"/>
      <provider name="outLoss"/>
      <provider name="outWavelength"/>
    </flow>
  </solver>

  <solver name="EffectiveFrequencyCyl" category="optical" lib="effective">
    Scalar optical solver based on the effective frequency method.

    <geometry type="Cylindrical"/>

    <mesh type="Rectangular2D, Ordered, Regular" optional="yes"/>

    <tag name="mode" label="Mode Properties">
      Mode properties.
      <attr name="lam0" label="Approximate wavelength" type="float" unit="nm">Approximate wavelength, around which the solution is searched. The refractive and group idexes are computed for this wavelength</attr>
      <attr name="emission" label="Direction of emission" type="choice" default="top">
        Direction of the useful light emission. Necessary for the over-threshold model to correctly compute the output power.
        <choice>top</choice>
        <choice>bottom</choice>
      </attr>
      <attr name="vlam" label="Vertical wavelength" type="float" unit="nm">&quot;Vertical wavelength&quot; i.e. the wavelength what would be in the absence of lateral confinement; setting this value helps to find models in very long resonators.</attr>
      <attr name="vat" label="Vertical solution coord" type="float" unit="µm">Horizontal position of at which the vertical part of the field is calculated.</attr>
      <!--attr name="asymptotic" label="Asymptotic outer field" type="bool">Flag indicating whether the solver uses asymptotic exponential field in the outermost layer.</attr-->
    </tag>

    <tag name="root" label="Parameters of the Horizontal Root-Finding Algorithm">
      Parameters of the horizontal root-finding algorithm.
      <attr name="method" label="Root finding method" type="choice" default="muller">
        Root finding algorithm.
        <choice>muller</choice>
        <choice>broyden</choice>
        <choice>brent</choice>
      </attr>
      <attr name="tolx" label="Tolerance on effective frequency" type="float" default="1e-6">Maximum change of the effective frequency parameter which is allowed for convergent solution.</attr>
      <attr name="tolf-min" label="Sufficient determinant value" type="float" default="1e-7">Minimum value of the determinant sufficient to assume convergence.</attr>
      <attr name="tolf-max" label="Required determinant value" type="float" default="2e-5">Maximum value of the determinant required to assume convergence.</attr>
      <attr name="maxstep" label="Maximum Broyden iteration step" type="float" default="0.1">Maximum step in one iteration of root finding. Significant for the Broyden's method only.</attr>
      <attr name="maxiter" label="Maximum number of iterations" type="int" default="500">Maximum number of root finding iterations.</attr>
      <attr name="alpha" label="Broyden decrease factor" type="float" default="1e-7">Parameter ensuring sufficient decrease of determinant in each step (Broyden method only).</attr>
      <attr name="lambda" label="Minimum Broyden step decrease ratio" type="float" default="1e-8">Minimum decrease ratio of one step (Broyden method only).</attr>
      <attr name="initial-range" label="Initial Muller range size" type="complex" default="1e-3">Initial range size (Muller method only).</attr>
    </tag>

    <tag name="stripe-root" label="Parameters of the Vertical Root-Finding Algorithm">
      Parameters of root-finding algorithm for one stripe.
      <attr name="method" label="Root finding method" type="choice" default="muller">
        Root finding algorithm.
        <choice>muller</choice>
        <choice>broyden</choice>
        <choice>brent</choice>
      </attr>
      <attr name="tolx" label="Tolerance on effective frequency" type="float" default="1e-6">Maximum change of the effective frequency parameter which is allowed for convergent solution.</attr>
      <attr name="tolf-min" label="Sufficient determinant value" type="float" default="1e-7">Minimum value of the determinant sufficient to assume convergence.</attr>
      <attr name="tolf-max" label="Required determinant value" type="float" default="1e-5">Maximum value of the determinant required to assume convergence.</attr>
      <attr name="maxstep" label="Maximum Broyden iteration step" type="float" default="0.1">Maximum step in one iteration of root finding. Significant for the Broyden's method only.</attr>
      <attr name="maxiter" label="Maximum number of iterations" type="int" default="500">Maximum number of root finding iterations.</attr>
      <attr name="alpha" label="Broyden decrease factor" type="float" default="1e-7">Parameter ensuring sufficient decrease of determinant in each step (Broyden method only).</attr>
      <attr name="lambda" label="Minimum Broyden step decrease ratio" type="float" default="1e-8">Minimum decrease ratio of one step (Broyden method only).</attr>
      <attr name="initial-range" label="Initial Muller range size" type="complex" default="1e-3">Initial range size (Muller method only).</attr>
    </tag>

    <flow>
      <receiver name="inTemperature"/>
      <receiver name="inGain"/>
      <provider name="outLightMagnitude"/>
      <provider name="outRefractiveIndex"/>
      <provider name="outHeat"/>
      <provider name="outLoss" for="ModalLoss"/>
      <provider name="outWavelength"/>
    </flow>
  </solver>
</solvers>
