#include <plask/config.hpp>


//////////////////////// Available preconditioners ////////////////////////

#define nspcg_rich1 F77_GLOBAL(rich1,RICH1)
F77SUB nspcg_rich1(...);

#define nspcg_rich2 F77_GLOBAL(rich2,RICH2)
F77SUB nspcg_rich2(...);

#define nspcg_rich3 F77_GLOBAL(rich3,RICH3)
F77SUB nspcg_rich3(...);

#define nspcg_rich4 F77_GLOBAL(rich4,RICH4)
F77SUB nspcg_rich4(...);

#define nspcg_rich5 F77_GLOBAL(rich5,RICH5)
F77SUB nspcg_rich5(...);

#define nspcg_jac1 F77_GLOBAL(jac1,JAC1)
F77SUB nspcg_jac1(...);

#define nspcg_jac2 F77_GLOBAL(jac2,JAC2)
F77SUB nspcg_jac2(...);

#define nspcg_jac3 F77_GLOBAL(jac3,JAC3)
F77SUB nspcg_jac3(...);

#define nspcg_jac4 F77_GLOBAL(jac4,JAC4)
F77SUB nspcg_jac4(...);

#define nspcg_jac5 F77_GLOBAL(jac5,JAC5)
F77SUB nspcg_jac5(...);

#define nspcg_ljac2 F77_GLOBAL(ljac2,LJAC2)
F77SUB nspcg_ljac2(...);

#define nspcg_ljac3 F77_GLOBAL(ljac3,LJAC3)
F77SUB nspcg_ljac3(...);

#define nspcg_ljacx2 F77_GLOBAL(ljacx2,LJACX2)
F77SUB nspcg_ljacx2(...);

#define nspcg_ljacx3 F77_GLOBAL(ljacx3,LJACX3)
F77SUB nspcg_ljacx3(...);

#define nspcg_sor1 F77_GLOBAL(sor1,SOR1)
F77SUB nspcg_sor1(...);

#define nspcg_sor2 F77_GLOBAL(sor2,SOR2)
F77SUB nspcg_sor2(...);

#define nspcg_sor3 F77_GLOBAL(sor3,SOR3)
F77SUB nspcg_sor3(...);

#define nspcg_sor6 F77_GLOBAL(sor6,SOR6)
F77SUB nspcg_sor6(...);

#define nspcg_sor7 F77_GLOBAL(sor7,SOR7)
F77SUB nspcg_sor7(...);

#define nspcg_ssor1 F77_GLOBAL(ssor1,SSOR1)
F77SUB nspcg_ssor1(...);

#define nspcg_ssor2 F77_GLOBAL(ssor2,SSOR2)
F77SUB nspcg_ssor2(...);

#define nspcg_ssor3 F77_GLOBAL(ssor3,SSOR3)
F77SUB nspcg_ssor3(...);

#define nspcg_ssor6 F77_GLOBAL(ssor6,SSOR6)
F77SUB nspcg_ssor6(...);

#define nspcg_ssor7 F77_GLOBAL(ssor7,SSOR7)
F77SUB nspcg_ssor7(...);

#define nspcg_ic1 F77_GLOBAL(ic1,IC1)
F77SUB nspcg_ic1(...);

#define nspcg_ic2 F77_GLOBAL(ic2,IC2)
F77SUB nspcg_ic2(...);

#define nspcg_ic3 F77_GLOBAL(ic3,IC3)
F77SUB nspcg_ic3(...);

#define nspcg_ic6 F77_GLOBAL(ic6,IC6)
F77SUB nspcg_ic6(...);

#define nspcg_mic1 F77_GLOBAL(mic1,MIC1)
F77SUB nspcg_mic1(...);

#define nspcg_mic2 F77_GLOBAL(mic2,MIC2)
F77SUB nspcg_mic2(...);

#define nspcg_mic3 F77_GLOBAL(mic3,MIC3)
F77SUB nspcg_mic3(...);

#define nspcg_mic6 F77_GLOBAL(mic6,MIC6)
F77SUB nspcg_mic6(...);

#define nspcg_lsp1 F77_GLOBAL(lsp1,LSP1)
F77SUB nspcg_lsp1(...);

#define nspcg_lsp2 F77_GLOBAL(lsp2,LSP2)
F77SUB nspcg_lsp2(...);

#define nspcg_lsp3 F77_GLOBAL(lsp3,LSP3)
F77SUB nspcg_lsp3(...);

#define nspcg_lsp4 F77_GLOBAL(lsp4,LSP4)
F77SUB nspcg_lsp4(...);

#define nspcg_lsp5 F77_GLOBAL(lsp5,LSP5)
F77SUB nspcg_lsp5(...);

#define nspcg_neu1 F77_GLOBAL(neu1,NEU1)
F77SUB nspcg_neu1(...);

#define nspcg_neu2 F77_GLOBAL(neu2,NEU2)
F77SUB nspcg_neu2(...);

#define nspcg_neu3 F77_GLOBAL(neu3,NEU3)
F77SUB nspcg_neu3(...);

#define nspcg_neu4 F77_GLOBAL(neu4,NEU4)
F77SUB nspcg_neu4(...);

#define nspcg_neu5 F77_GLOBAL(neu5,NEU5)
F77SUB nspcg_neu5(...);

#define nspcg_lsor2 F77_GLOBAL(lsor2,LSOR2)
F77SUB nspcg_lsor2(...);

#define nspcg_lsor3 F77_GLOBAL(lsor3,LSOR3)
F77SUB nspcg_lsor3(...);

#define nspcg_lssor2 F77_GLOBAL(lssor2,LSSOR2)
F77SUB nspcg_lssor2(...);

#define nspcg_lssor3 F77_GLOBAL(lssor3,LSSOR3)
F77SUB nspcg_lssor3(...);

#define nspcg_llsp2 F77_GLOBAL(llsp2,LLSP2)
F77SUB nspcg_llsp2(...);

#define nspcg_llsp3 F77_GLOBAL(llsp3,LLSP3)
F77SUB nspcg_llsp3(...);

#define nspcg_lneu2 F77_GLOBAL(lneu2,LNEU2)
F77SUB nspcg_lneu2(...);

#define nspcg_lneu3 F77_GLOBAL(lneu3,LNEU3)
F77SUB nspcg_lneu3(...);

#define nspcg_bic2 F77_GLOBAL(bic2,BIC2)
F77SUB nspcg_bic2(...);

#define nspcg_bic3 F77_GLOBAL(bic3,BIC3)
F77SUB nspcg_bic3(...);

#define nspcg_bic7 F77_GLOBAL(bic7,BIC7)
F77SUB nspcg_bic7(...);

#define nspcg_bicx2 F77_GLOBAL(bicx2,BICX2)
F77SUB nspcg_bicx2(...);

#define nspcg_bicx3 F77_GLOBAL(bicx3,BICX3)
F77SUB nspcg_bicx3(...);

#define nspcg_bicx7 F77_GLOBAL(bicx7,BICX7)
F77SUB nspcg_bicx7(...);

#define nspcg_mbic2 F77_GLOBAL(mbic2,MBIC2)
F77SUB nspcg_mbic2(...);

#define nspcg_mbic3 F77_GLOBAL(mbic3,MBIC3)
F77SUB nspcg_mbic3(...);

#define nspcg_mbic7 F77_GLOBAL(mbic7,MBIC7)
F77SUB nspcg_mbic7(...);

#define nspcg_mbicx2 F77_GLOBAL(mbicx2,MBICX2)
F77SUB nspcg_mbicx2(...);

#define nspcg_mbicx3 F77_GLOBAL(mbicx3,MBICX3)
F77SUB nspcg_mbicx3(...);

#define nspcg_mbicx7 F77_GLOBAL(mbicx7,MBICX7)
F77SUB nspcg_mbicx7(...);

#define nspcg_rs6 F77_GLOBAL(rs6,RS6)
F77SUB nspcg_rs6(...);

#define nspcg_rs7 F77_GLOBAL(rs7,RS7)
F77SUB nspcg_rs7(...);


//////////////////////// Available accelerators ////////////////////////

#define nspcg_cg F77_GLOBAL(cg,CG)
F77SUB nspcg_cg(...);

#define nspcg_si F77_GLOBAL(si,SI)
F77SUB nspcg_si(...);

#define nspcg_sor F77_GLOBAL(sor,SOR)
F77SUB nspcg_sor(...);

#define nspcg_srcg F77_GLOBAL(srcg,SRCG)
F77SUB nspcg_srcg(...);

#define nspcg_srsi F77_GLOBAL(srsi,SRSI)
F77SUB nspcg_srsi(...);

#define nspcg_basic F77_GLOBAL(basic,BASIC)
F77SUB nspcg_basic(...);

#define nspcg_me F77_GLOBAL(me,ME)
F77SUB nspcg_me(...);

#define nspcg_cgnr F77_GLOBAL(cgnr,CGNR)
F77SUB nspcg_cgnr(...);

#define nspcg_lsqr F77_GLOBAL(lsqr,LSQR)
F77SUB nspcg_lsqr(...);

#define nspcg_odir F77_GLOBAL(odir,ODIR)
F77SUB nspcg_odir(...);

#define nspcg_omin F77_GLOBAL(omin,OMIN)
F77SUB nspcg_omin(...);

#define nspcg_ores F77_GLOBAL(ores,ORES)
F77SUB nspcg_ores(...);

#define nspcg_iom F77_GLOBAL(iom,IOM)
F77SUB nspcg_iom(...);

#define nspcg_gmres F77_GLOBAL(gmres,GMRES)
F77SUB nspcg_gmres(...);

#define nspcg_usymlq F77_GLOBAL(usymlq,USYMLQ)
F77SUB nspcg_usymlq(...);

#define nspcg_usymqr F77_GLOBAL(usymqr,USYMQR)
F77SUB nspcg_usymqr(...);

#define nspcg_landir F77_GLOBAL(landir,LANDIR)
F77SUB nspcg_landir(...);

#define nspcg_lanmin F77_GLOBAL(lanmin,LANMIN)
F77SUB nspcg_lanmin(...);

#define nspcg_lanres F77_GLOBAL(lanres,LANRES)
F77SUB nspcg_lanres(...);

#define nspcg_cgcr F77_GLOBAL(cgcr,CGCR)
F77SUB nspcg_cgcr(...);

#define nspcg_bcgs F77_GLOBAL(bcgs,BCGS)
F77SUB nspcg_bcgs(...);

//////////////////////// Parameters structures ////////////////////////

struct iparm_t {
    int ntest;      // (default: 2)
    int itmax;      // (default: 100)
    int level;      // (default: 0)
    int nout;       // (default: 6)
    int idgts;      // (default: 0)
    int maxadp;     // (default: 1)
    int minadp;     // (default: 1)
    int iomgad;     // (default: 1)
    int ns1;        // (default: 5)
    int ns2;        // (default: 100000)
    int ns3;        // (default: 0)
    int nstore;     // (default: 2)
    int iscale;     // (default: 0)
    int iperm;      // (default: 0)
    int ifact;      // (default: 1)
    int lvfill;     // (default: 0)
    int ltrunc;     // (default: 0)
    int ipropa;     // (default: 2)
    int kblsz;      // (default: −1)
    int nbl2d;      // (default: −1)
    int ifctv;      // (default: 1)
    int iqlr;       // (default: 1)
    int isymm;      // (default: 2)
    int ielim;      // (default: 0)
    int ndeg;       // (default: 1)
    int __pad[5];   // to total 30 integers

    // Allow to use iparm as an array like in Fortran
    int& operator[](int i) { return *((int*)this + i); }
    const int& operator[](int i) const { return *((int*)this + i); }
};

struct rparm_t {
    double zeta;    // (default: 10e−6)
    double emax;    // (default: 2.0)
    double emin;    // (default: 1.0)
    double ff;      // (default: 0.75)
    double fff;     // (default: 0.75)
    double timit;   // (default: 0.0)
    double digit1;  // (default: 0.0)
    double digit2;  // (default: 0.0)
    double omega;   // (default: 1.0)
    double alphab;  // (default: 0.0)
    double betab;   // (default: 0.25)
    double specr;   // (default: 0.0)
    double timfac;  // (default: 0.0)
    double timtot;  // (default: 0.0)
    double tol;     // (default: 500 ∗ srelpr)
    double ainf;    // (default: 0.0)
    double __pad[14]; // to total 30 doubles

    // Allow to use rparm as an array like in Fortran
    double& operator[](int i) { return *((double*)this + i); }
    const double& operator[](int i) const { return *((double*)this + i); }
};

//////////////////////// Main procedures ////////////////////////

#define nspcg F77_GLOBAL(nspcg,NSPCG)
/**
 * Driver for the nspcg package.
 *
 * \param precon        preconditioning module
 * \param accel         acceleration module
 * \param ndim          row dimension of the \c coef array
 * \param mdim          column dimension of the \c coef array
 * \param n             order of the system
 * \param[inout] maxnz  active column width of the \c coef array
 * \param coef          matrix data array
 * \param jcoef         matrix data array
 * \param p, ip         pivot and inverse pivot information (or certain solvers, these vectors may not be necessary)
 * \param[inout] u      on input the initial guess to the solution, on output the latest estimate to the solution
 * \param ubar          optional input quantity containing the true solution
 * \param rhs           right hand side of the matrix problem
 * \param wksp          real workspace array
 * \param iwksp         integer workspace array
 * \param nw            length of \c wksp
 * \param inw           length of \c iwksp
 * \param[inout] iparm  some integer parameters which affect the method [30]
 * \param[inout] rparm  some real parameters which affect the method [30]
 * \param[out] ier      the error flag
 */
F77SUB nspcg(void (*precon)(...), void (*accel)(...), const int& ndim, const int& mdim, const int& n, int& maxnz,
             double* coef, int* jcoef, int* p, int* ip, double* u, double* ubar, double* rhs,
             double* wksp, int* iwksp, int& nw, int& inw, iparm_t& iparm, rparm_t& rparm, int& ier);

#define nspcg_dfault F77_GLOBAL(dfault,DFAULT)
/**
 * Sets the default values of \c iparm and \c rparm.
 */
F77SUB nspcg_dfault(iparm_t& iparm, rparm_t& rparm);
