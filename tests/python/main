import sys, unittest

if __name__ == '__main__':
    exec(compile(open(sys.argv[1]).read(), "somefile.py", 'exec'), globals(), locals())
    tests = []
    for m in dict(globals()).values():
        try:
            if issubclass(m, unittest.TestCase):
                tests.append(m)
        except TypeError:
            pass

    errors = 0

    for m in tests:
            suite = unittest.TestLoader().loadTestsFromTestCase(m)
            result = unittest.TextTestRunner().run(suite)
            errors += len(result.errors) + len(result.failures)

    sys.exit(errors)

#kate: syntax Python;
