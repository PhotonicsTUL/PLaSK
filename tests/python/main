#!/usr/bin/python
# -*- coding: utf-8 -*-

import sys, os, unittest, imp

# Load test as a module
mod_path = os.path.dirname(sys.argv[1])
mod_name = os.path.basename(sys.argv[1])
if mod_name[-3:] == '.py': mod_name = mod_name[:-3]
fp, pathname, description = imp.find_module(mod_name, [mod_path])
test_module = imp.load_module(mod_name, fp, pathname, description)

tests = []
for m in test_module.__dict__.values():
    try:
        if issubclass(m, unittest.TestCase):
            tests.append(m)
    except TypeError:
        pass

errors = 0

for m in tests:
        suite = unittest.TestLoader().loadTestsFromTestCase(m)
        result = unittest.TextTestRunner().run(suite)
        errors += len(result.errors) + len(result.failures)

sys.exit(errors)

#kate: syntax Python;
